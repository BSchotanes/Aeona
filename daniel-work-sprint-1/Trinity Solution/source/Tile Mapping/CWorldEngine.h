//    File Name				:	"CWorldEngine.h"
//
//    Author Name			:	Daniel Lima
//    Creation Date			:	02/13 - 8:40 PM
//    Purpose				:	Singleton that handles the loading
//								and storage of all the maps and
//								puzzles in the game
////////////////////////////////////////////////////////////////////////

// Standard header protection
#ifndef C_WORLD_ENGINE_H_
#define C_WORLD_ENGINE_H_

#include "CMap.h"

// For CheckCollisions
class IBaseInterface;

// WorldEngine class - proper singleton
class CWorldEngine
{
	//////////////////////////////////////////////////////////////////////////
	//	------------------------------------------------------------------	//
	//							DATA	MEMBERS								//
	//	------------------------------------------------------------------	//
	//////////////////////////////////////////////////////////////////////////

	//	Vector of maps
	vector<CMap*>			m_vpMaps;

	// Vector of tilesets
	vector<CTileset*>		m_vpTilesets;

	// Rectangle with screen area to render and check collisions
	RECT					m_rDrawArea;

	//	Static member pointer Instance - Singleton
	static CWorldEngine*	sm_pInstance;

	//////////////////////////////////////////////////////////////////////////
	//	------------------------------------------------------------------	//
	//							PRIVATE	FUNCTIONS							//
	//	------------------------------------------------------------------	//
	//////////////////////////////////////////////////////////////////////////

	//	Constructor
	CWorldEngine(void) {}

	//	Proper singleton needs the trilogy of evil
	//		Copy Constructor
	CWorldEngine(const CWorldEngine&) {}
	//		Assignment Operator
	CWorldEngine& operator=(const CWorldEngine&) {}
	//		Destructor
	~CWorldEngine(void) {}

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Load all maps defined in an XML File
	//	Parameters	:	szFilename: File that has all the maps' file names
	////////////////////////////////////////////////////////////////////////
	void LoadAllMaps(const char* szFilename);

public:
	//////////////////////////////////////////////////////////////////////////
	//	------------------------------------------------------------------	//
	//							PUBLIC	FUNCTIONS							//
	//	------------------------------------------------------------------	//
	//////////////////////////////////////////////////////////////////////////

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Singleton's accessor
	////////////////////////////////////////////////////////////////////////
	static CWorldEngine* GetInstance(void);

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Initialize all variables, call LoadAllMaps()
	////////////////////////////////////////////////////////////////////////
	void InitWorldEngine(void);

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Updates all maps
	////////////////////////////////////////////////////////////////////////
	void UpdateWorld(float fElapsedTime);

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Render all maps
	////////////////////////////////////////////////////////////////////////
	void RenderWorld(void);

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Check collisions against all tiles on screen
	//	Parameters	:	pBase - Object that we're checking collisions with
	//	Return		:	False if collided, true otherwise
	////////////////////////////////////////////////////////////////////////
	bool CheckCollisions(const IBaseInterface* pBase);

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Unload files
	////////////////////////////////////////////////////////////////////////
	void ShutdownWorldEngine(void);

	////////////////////////////////////////////////////////////////////////
	//	Purpose		:	Delete the singleton's instance
	////////////////////////////////////////////////////////////////////////
	static void DeleteInstance(void);
};

#endif // C_WORLD_ENGINE_H_